<!DOCTYPE html>
<html>
<head>


    <!-- Baidu Push -->
    <script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();


    </script>
    <!-- End Baidu Push -->


    <meta charset="utf-8">

    <meta name="google-site-verification" content="true">
    <meta name="baidu-site-verification" content="97dbRVWfVh"/>
    <meta name="sogou_site_verification" content="AIePRXkUI4"/>


    <link rel="canonical" href="http://www.likeqy.com/2017/07/26/TabLayout源码解析/">

    <title>TabLayout源码解析 › likeqy.com | ：专注于物联网，AI，AR，大数据，智能家居，智能汽车领域，但不局限于Android开发。晴雨【qy】</title>

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <meta name="theme-color" content="#3F51B5">


    <meta name="description"
          content="项目地址： https://github.com/itgoyo/AndroidSource-Analysis 简介： Android源码分析，让你更清楚的理解每一个组件的功能与用法。 TabLayout 源码解析1. 功能介绍1.1 TabLayoutTabs跟随Actionbar在Android 3.0进入大家的视线，是一个很经典的设计。它也是Material Design 规范中提及的Com">
    <meta name="keywords" content="Android">
    <meta property="og:type" content="article">
    <meta property="og:title" content="TabLayout源码解析">
    <meta property="og:url" content="https://likeqy.com/2017/07/26/TabLayout源码解析/index.html">
    <meta property="og:site_name" content="likeqy.com">
    <meta property="og:description"
          content="项目地址： https://github.com/itgoyo/AndroidSource-Analysis 简介： Android源码分析，让你更清楚的理解每一个组件的功能与用法。 TabLayout 源码解析1. 功能介绍1.1 TabLayoutTabs跟随Actionbar在Android 3.0进入大家的视线，是一个很经典的设计。它也是Material Design 规范中提及的Com">
    <meta property="og:image" content="https://likeqy.com/res/likeqy_group.png">
    <meta property="og:updated_time" content="2017-07-26T12:06:32.545Z">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="TabLayout源码解析">

    <link rel="alternative" href="/atom.xml" title="likeqy.com" type="application/atom+xml">

    <link rel="shortcut icon" href="/res/err.png">
    <link rel="stylesheet" href="/css/style.css?v=1.5.2">
    <script>window.lazyScripts=[]</script>

    <script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?c16d3c10c9ea6c6fe749d9926d52b0d6";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();


    </script>

</head>

<body>
<div id="loading" class="active"></div>

<aside id="menu" style="
    width: 300px;">
    <div class="inner flex-row-vertical">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light"
           id="menu-off">
            <i class="icon icon-lg icon-close"></i>
        </a>
        <div class="brand-wrap" style="background-image:url(/res/index-page-topleft-bg.jpg)">
            <div class="brand" style="
          width: 300px;">
                <a href="/" class="avatar waves-effect waves-circle waves-light">
                    <img src="/res/index-page-likeqy.jpg">
                </a>
                <hgroup class="introduce">
                    <h5 class="nickname">likeqy</h5>
                    <a href="mailto:qyddai@gmail.com" title="qyddai@gmail.com" class="mail">qyddai@gmail.com</a>
                </hgroup>
            </div>
        </div>
        <div class="scroll-wrap flex-col" style="
        width: 300px;">
            <ul class="nav">

                <li class="waves-block waves-effect active">
                    <a href="/">
                        <i class="icon icon-lg icon-home"></i>
                        主页
                    </a>
                </li>

                <li class="waves-block waves-effect">
                    <a href="/archives">
                        <i class="icon icon-lg icon-archives"></i>
                        Archive（档案）
                    </a>
                </li>

                <li class="waves-block waves-effect">
                    <a href="/tags">
                        <i class="icon icon-lg icon-tags"></i>
                        标签
                    </a>
                </li>

                <li class="waves-block waves-effect">
                    <a href="/categories">
                        <i class="icon icon-lg icon-th-list"></i>
                        分类
                    </a>
                </li>

                <li class="waves-block waves-effect">
                    <a href="Mailto:qyddai@gmail.com">
                        <i class="icon icon-lg icon-envelope"></i>
                        邮件
                    </a>
                </li>

                <li class="waves-block waves-effect">
                    <a href="https://github.com/qydq">
                        <i class="icon icon-lg icon-github"></i>
                        Github
                    </a>
                </li>

                <li class="waves-block waves-effect">
                    <a href="/resume">
                        <i class="icon icon-lg icon-file-text"></i>
                        Résumé
                    </a>
                </li>

                <div class="div_right_bottom" align="center">
                    <img src="http://open.weixin.qq.com/qr/code/?username=liketip">
                    微信公众号[LikeTip]
                </div>

            </ul>
        </div>
    </div>
</aside>

<main id="main">
    <header class="top-header" id="header">
        <div class="flex-row">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on"
               id="menu-toggle">
                <i class="icon icon-lg icon-navicon"></i>
            </a>
            <div class="flex-col header-title ellipsis">TabLayout源码解析</div>

            <div class="search-wrap" id="search-wrap">
                <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light"
                   id="back">
                    <i class="icon icon-lg icon-chevron-left"></i>
                </a>
                <input type="text" id="key" class="search-input" autocomplete="off"
                       placeholder="输入感兴趣的关键字">
                <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light"
                   id="search">
                    <i class="icon icon-lg icon-search"></i>
                </a>
            </div>


            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light"
               id="menuShare">
                <i class="icon icon-lg icon-share-alt"></i>
            </a>

        </div>
    </header>
    <header class="content-header post-header">

        <div class="container fade-scale">
            <h1 class="title">TabLayout源码解析</h1>
            <h5 class="subtitle">

                <time datetime="2017-07-26T12:06:13.000Z" itemprop="datePublished"
                      class="page-time">
                    2017-07-26
                </time>


                <ul class="article-category-list">
                    <li class="article-category-list-item"><a class="article-category-list-link"
                                                              href="/categories/源码分析/">源码分析</a></li>
                </ul>


            </h5>
        </div>


    </header>


    <div class="container body-wrap">

        <aside class="post-widget">
            <nav class="post-toc-wrap" id="post-toc">
                <h4>TOC</h4>
                <ol class="post-toc">
                    <li class="post-toc-item post-toc-level-1">
                        <a class="post-toc-link"
                       href="#TabLayout-源码解析">
                            <span
                            class="post-toc-number">1.</span>
                            <span class="post-toc-text">TabLayout 源码解析</span>
                        </a>
                        <ol class="post-toc-child">
                            <li class="post-toc-item post-toc-level-2"><a class="post-toc-link"
                                                                          href="#1-功能介绍"><span
                                    class="post-toc-number">1.1.</span> <span class="post-toc-text">1. 功能介绍</span></a>
                                <ol class="post-toc-child">
                                    <li class="post-toc-item post-toc-level-3"><a
                                            class="post-toc-link" href="#1-1-TabLayout"><span
                                            class="post-toc-number">1.1.1.</span> <span
                                            class="post-toc-text">1.1 TabLayout</span></a></li>
                                    <li class="post-toc-item post-toc-level-3"><a
                                            class="post-toc-link" href="#1-2-TabLayout使用"><span
                                            class="post-toc-number">1.1.2.</span> <span
                                            class="post-toc-text">1.2 TabLayout使用</span></a>
                                        <ol class="post-toc-child">
                                            <li class="post-toc-item post-toc-level-4"><a
                                                    class="post-toc-link"
                                                    href="#1-2-1-TabLayout单独使用"><span
                                                    class="post-toc-number">1.1.2.1.</span> <span
                                                    class="post-toc-text">1.2.1 TabLayout单独使用</span></a>
                                            </li>
                                            <li class="post-toc-item post-toc-level-4"><a
                                                    class="post-toc-link"
                                                    href="#1-2-2-与ViewPager搭配使用"><span
                                                    class="post-toc-number">1.1.2.2.</span> <span
                                                    class="post-toc-text">1.2.2 与ViewPager搭配使用</span></a>
                                            </li>
                                        </ol>
                                    </li>
                                </ol>
                            </li>
                            <li class="post-toc-item post-toc-level-2"><a class="post-toc-link"
                                                                          href="#2-总体设计"><span
                                    class="post-toc-number">1.2.</span> <span class="post-toc-text">2. 总体设计</span></a>
                            </li>
                            <li class="post-toc-item post-toc-level-2"><a class="post-toc-link"
                                                                          href="#3-详细设计"><span
                                    class="post-toc-number">1.3.</span> <span class="post-toc-text">3. 详细设计</span></a>
                                <ol class="post-toc-child">
                                    <li class="post-toc-item post-toc-level-3"><a
                                            class="post-toc-link" href="#3-1-类关系图"><span
                                            class="post-toc-number">1.3.1.</span> <span
                                            class="post-toc-text">3.1 类关系图</span></a></li>
                                    <li class="post-toc-item post-toc-level-3"><a
                                            class="post-toc-link" href="#3-2-分析"><span
                                            class="post-toc-number">1.3.2.</span> <span
                                            class="post-toc-text">3.2 分析</span></a>
                                        <ol class="post-toc-child">
                                            <li class="post-toc-item post-toc-level-4"><a
                                                    class="post-toc-link"
                                                    href="#3-2-1-TabLayout子View唯一性保证"><span
                                                    class="post-toc-number">1.3.2.1.</span> <span
                                                    class="post-toc-text">3.2.1 TabLayout子View唯一性保证</span></a>
                                            </li>
                                            <li class="post-toc-item post-toc-level-4"><a
                                                    class="post-toc-link"
                                                    href="#3-2-2-与ViewPager搭配使用"><span
                                                    class="post-toc-number">1.3.2.2.</span> <span
                                                    class="post-toc-text">3.2.2 与ViewPager搭配使用</span></a>
                                            </li>
                                            <li class="post-toc-item post-toc-level-4"><a
                                                    class="post-toc-link"
                                                    href="#3-2-3-ViewPager与TabLayout的Tab及indicaotr协同滚动"><span
                                                    class="post-toc-number">1.3.2.3.</span> <span
                                                    class="post-toc-text">3.2.3 ViewPager与TabLayout的Tab及indicaotr协同滚动</span></a>
                                                <ol class="post-toc-child">
                                                    <li class="post-toc-item post-toc-level-5"><a
                                                            class="post-toc-link"
                                                            href="#3-2-3-1-TabLayout的Indicator协同滚动"><span
                                                            class="post-toc-number">1.3.2.3.1.</span>
                                                        <span class="post-toc-text">3.2.3.1 TabLayout的Indicator协同滚动</span></a>
                                                    </li>
                                                    <li class="post-toc-item post-toc-level-5"><a
                                                            class="post-toc-link"
                                                            href="#3-2-3-2-TabLayout的TabView协同滚动"><span
                                                            class="post-toc-number">1.3.2.3.2.</span>
                                                        <span class="post-toc-text">3.2.3.2 TabLayout的TabView协同滚动</span></a>
                                                    </li>
                                                </ol>
                                            </li>
                                        </ol>
                                    </li>
                                    <li class="post-toc-item post-toc-level-3"><a
                                            class="post-toc-link" href="#3-2-4-Tab选中状态"><span
                                            class="post-toc-number">1.3.3.</span> <span
                                            class="post-toc-text">3.2.4 Tab选中状态</span></a></li>
                                </ol>
                            </li>
                            <li class="post-toc-item post-toc-level-2"><a class="post-toc-link"
                                                                          href="#4-开源项目中的使用"><span
                                    class="post-toc-number">1.4.</span> <span class="post-toc-text">4. 开源项目中的使用</span></a>
                            </li>
                        </ol>
                    </li>
                </ol>
            </nav>
        </aside>

        <article id="post-TabLayout源码解析"
                 class="post-article article-type-post fade" itemprop="blogPost">

            <div class="post-card">
                <h1 class="post-card-title">TabLayout源码解析</h1>
                <div class="post-meta">
                    <time class="post-time" title="2017-07-26 20:06:13"
                          datetime="2017-07-26T12:06:13.000Z" itemprop="datePublished">2017-07-26
                    </time>


                    <ul class="article-category-list">
                        <li class="article-category-list-item"><a class="article-category-list-link"
                                                                  href="/categories/源码分析/">源码分析</a>
                        </li>
                    </ul>




<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


                </div>
                <div class="post-content" id="post-content" itemprop="postContent">
                    <p>
                        <img src="https://img.shields.io/github/stars/itgoyo/AndroidSource-Analysis.svg?style=social&amp;label=Star"
                             alt=""></p>
                    <p>本文为转载&地址：项目地址： <a href="https://github.com/itgoyo/AndroidSource-Analysis"
                                         target="_blank" rel="external">https://github.com/itgoyo/AndroidSource-Analysis</a>
                    </p>
                    <p>简介： Android源码分析，让你更清楚的理解每一个组件的功能与用法。</p>
                    <h1 id="TabLayout-源码解析"><a href="#TabLayout-源码解析" class="headerlink"
                                               title="TabLayout 源码解析"></a>TabLayout 源码解析</h1>
                    <h2 id="1-功能介绍"><a href="#1-功能介绍" class="headerlink" title="1. 功能介绍"></a>1. 功能介绍
                    </h2>
                    <h3 id="1-1-TabLayout"><a href="#1-1-TabLayout" class="headerlink"
                                              title="1.1 TabLayout"></a>1.1 TabLayout</h3>
                    <p>Tabs跟随Actionbar在Android 3.0进入大家的视线，是一个很经典的设计。它也是Material Design 规范中提及的<code>Component</code>之一。Tabs
                        or Bottom
                        navigation？相信不少Android开发者与产品都撕过，就连微信在其中也有过抉择。Google在Google+以及Google
                        Photo中相继采用Bottom navigation的设计把剧情推到向高潮，一度轰动整个社区。Google继而在Material Design
                        规范加入了Bottom navigation，表明了态度，也给这起争论画上了圆满的句号。</p>
                    <p>在 support desgin lib 发布前，大家基本都采用<a
                            href="https://github.com/astuetz/PagerSlidingTabStrip" target="_blank"
                            rel="external">PagerSlidingTabStrip</a>来实现tab效果。其实<code>TabLayout</code>在实现上和<code>PagerSlidingTabStrip</code>十分相似，今天我们来分析<code>TabLayout</code>。
                    </p>
                    <h3 id="1-2-TabLayout使用"><a href="#1-2-TabLayout使用" class="headerlink"
                                                title="1.2 TabLayout使用"></a>1.2 TabLayout使用</h3>
                    <p><code>TabLayout</code>使用比较简单。既可以单独使用，也可以与<code>ViewPager</code>配合使用。</p>
                    <h4 id="1-2-1-TabLayout单独使用"><a href="#1-2-1-TabLayout单独使用" class="headerlink"
                                                    title="1.2.1 TabLayout单独使用"></a>1.2.1
                        TabLayout单独使用</h4>
                    <p>在java代码中添加Tabs<br>
                        <figure class="highlight java">
                            <table>
                                <tr>
                                    <td class="gutter">
                                        <pre><div class="line">1</div><div class="line">2</div><div
                                                class="line">3</div><div class="line">4</div></pre>
                                    </td>
                                    <td class="code">
                                        <pre><div class="line">TabLayout tabLayout = (TabLayout) findViewById(R.id.tabLayout);</div><div
                                                class="line">tabLayout.addTab(tabLayout.newTab().setText(<span
                                                class="string">"Tab 1"</span>));</div><div
                                                class="line">tabLayout.addTab(tabLayout.newTab().setText(<span
                                                class="string">"Tab 2"</span>));</div><div
                                                class="line">tabLayout.addTab(tabLayout.newTab().setText(<span
                                                class="string">"Tab 3"</span>));</div></pre>
                                    </td>
                                </tr>
                            </table>
                        </figure>
                    </p>
                    <p>也可以在xml中添加Tabs<br>
                        <figure class="highlight xml">
                            <table>
                                <tr>
                                    <td class="gutter">
                                        <pre><div class="line">1</div><div class="line">2</div><div
                                                class="line">3</div><div class="line">4</div><div
                                                class="line">5</div><div class="line">6</div><div
                                                class="line">7</div><div class="line">8</div><div
                                                class="line">9</div><div class="line">10</div><div
                                                class="line">11</div></pre>
                                    </td>
                                    <td class="code">
                                        <pre><div class="line"><span class="tag">&lt;<span
                                                class="name">android.support.design.widget.TabLayout</span></span></div><div
                                                class="line">    <span class="attr">android:layout_height</span>=<span
                                                class="string">"wrap_content"</span></div><div
                                                class="line">    <span class="attr">android:layout_width</span>=<span
                                                class="string">"match_parent"</span>&gt;</div><div
                                                class="line"></div><div class="line">    <span
                                                class="tag">&lt;<span class="name">android.support.design.widget.TabItem</span></span></div><div
                                                class="line">        <span
                                                class="attr">android:text</span>=<span
                                                class="string">"@string/tab_text"</span>/&gt;</div><div
                                                class="line"></div><div class="line">    <span
                                                class="tag">&lt;<span class="name">android.support.design.widget.TabItem</span></span></div><div
                                                class="line">        <span
                                                class="attr">android:icon</span>=<span
                                                class="string">"@drawable/ic_android"</span>/&gt;</div><div
                                                class="line"></div><div class="line"><span
                                                class="tag">&lt;/<span class="name">android.support.design.widget.TabLayout</span>&gt;</span></div></pre>
                                    </td>
                                </tr>
                            </table>
                        </figure>
                    </p>
                    <h4 id="1-2-2-与ViewPager搭配使用"><a href="#1-2-2-与ViewPager搭配使用" class="headerlink"
                                                     title="1.2.2 与ViewPager搭配使用"></a>1.2.2
                        与ViewPager搭配使用</h4>
                    <figure class="highlight java">
                        <table>
                            <tr>
                                <td class="gutter">
                                    <pre><div class="line">1</div><div class="line">2</div><div
                                            class="line">3</div><div class="line">4</div><div
                                            class="line">5</div><div class="line">6</div><div
                                            class="line">7</div><div class="line">8</div><div
                                            class="line">9</div><div class="line">10</div><div
                                            class="line">11</div><div class="line">12</div><div
                                            class="line">13</div><div class="line">14</div></pre>
                                </td>
                                <td class="code">
                                    <pre><div class="line"><span class="comment">// find view</span></div><div
                                            class="line">TabLayout tabLayout = ...;</div><div
                                            class="line">ViewPager viewPager = ...;</div><div
                                            class="line"></div><div class="line">PagerAdapter adapter = <span
                                            class="keyword">new</span> PagerAdapter()&#123;</div><div
                                            class="line">    <span class="comment">// ...Override some methods</span></div><div
                                            class="line">    <span class="comment">// TabLayout调用这个方法获取Tab的title</span></div><div
                                            class="line">    <span
                                            class="meta">@Override</span></div><div class="line">    <span
                                            class="function"><span class="keyword">public</span> CharSequence <span
                                            class="title">getPageTitle</span><span
                                            class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</div><div
                                            class="line">        <span class="keyword">return</span> <span
                                            class="string">"Tab 1"</span>;</div><div class="line">    &#125;</div><div
                                            class="line">&#125;</div><div class="line">viewPager.setAdapter(adapter);</div><div
                                            class="line">tabLayout.setupWithViewPager(viewPager);</div></pre>
                                </td>
                            </tr>
                        </table>
                    </figure>
                    <h2 id="2-总体设计"><a href="#2-总体设计" class="headerlink" title="2. 总体设计"></a>2. 总体设计
                    </h2>
                    <ul>
                        <li><p><code>TabLayout</code>继承<code>HorizontalScrollView</code>天生就是一个可以横向滚动的<code>ViewGroup</code>.
                            我们知道, <code>HorizontalScrollView</code>与<code>ScrollView</code>一样,
                            最多只能包含一个子View.</p>
                        </li>
                        <li><p><code>SlidingTabStrip</code>继承于<code>LinearLayout</code>，是<code>TabLayout</code>的内部类。它是<code>TabLayout</code>唯一的子View.
                            所有的<code>TabView</code>都是它的子View.</p>
                        </li>
                        <li><p><code>TabView</code>继承于<code>LinearLayout</code>,以<code>Tab</code>为数据源，来展示Tab的样式。最终用for循环被add进<code>SlidingTabStrip</code>.
                        </p>
                        </li>
                        <li><p><code>Tab</code>是一个简单的View Model实体类，控制<code>TabView</code>的title,
                            icon, custom layout id等属性。</p>
                        </li>
                        <li><p><code>TabItem</code>继承于View. 用于在layout xml中来描述Tab.
                            需要注意的是，它不会add到<code>SlidingTabStrip</code>中去。它的作用是从xml中获取到text，icon，custom
                            layout id等属性。TabLayout
                            inflate到<code>TabItem</code>并获取属性到装配到<code>Tab</code>中，最终add到<code>SlidingTabStrip</code>中的还是<code>TabView</code>.
                        </p>
                        </li>
                        <li><p><code>OnTabSelectedListener</code>是TabLayout中的内部接口，用于监听<code>SlidingTabStrip</code>中子<code>TabView</code>选中状态的改变。
                        </p>
                        </li>
                        <li><p><code>Mode</code>是TabLayout滚动模式的描述，一共有两种状态。<code>MODE_FIXED</code>不可滚动模式，以及<code>MODE_SCROLLABLE</code>可以滚动模式。
                        </p>
                        </li>
                        <li><p>
                            <code>Gravity</code>是<code>TabView</code>在<code>SlidingTabStrip</code>中layout方式的描述。分为：GRAVITY_FILL，GRAVITY_CENTER.
                        </p>
                        </li>
                    </ul>
                    <h2 id="3-详细设计"><a href="#3-详细设计" class="headerlink" title="3. 详细设计"></a>3. 详细设计
                    </h2>
                    <h3 id="3-1-类关系图"><a href="#3-1-类关系图" class="headerlink" title="3.1 类关系图"></a>3.1
                        类关系图</h3>
                    <p><img src="../assets/tablayout.png" alt="TabLayout"></p>
                    <h3 id="3-2-分析"><a href="#3-2-分析" class="headerlink" title="3.2 分析"></a>3.2 分析
                    </h3><h4 id="3-2-1-TabLayout子View唯一性保证"><a href="#3-2-1-TabLayout子View唯一性保证"
                                                               class="headerlink"
                                                               title="3.2.1 TabLayout子View唯一性保证"></a>3.2.1
                    TabLayout子View唯一性保证</h4>
                    <p>前面介绍<code>TabLayout</code>继承于<code>HorizontalScrollView</code>最多只能有1个子View. 但<code>TabLayout</code>可以在layout中添加多个子View节点.
                        这是怎么回事呢？<br>
                        <figure class="highlight xml">
                            <table>
                                <tr>
                                    <td class="gutter">
                                        <pre><div class="line">1</div><div class="line">2</div><div
                                                class="line">3</div><div class="line">4</div><div
                                                class="line">5</div><div class="line">6</div><div
                                                class="line">7</div><div class="line">8</div><div
                                                class="line">9</div><div class="line">10</div><div
                                                class="line">11</div></pre>
                                    </td>
                                    <td class="code">
                                        <pre><div class="line"><span class="tag">&lt;<span
                                                class="name">android.support.design.widget.TabLayout</span></span></div><div
                                                class="line">    <span class="attr">android:layout_height</span>=<span
                                                class="string">"wrap_content"</span></div><div
                                                class="line">    <span class="attr">android:layout_width</span>=<span
                                                class="string">"match_parent"</span>&gt;</div><div
                                                class="line"></div><div class="line">    <span
                                                class="tag">&lt;<span class="name">android.support.design.widget.TabItem</span></span></div><div
                                                class="line">        <span
                                                class="attr">android:text</span>=<span
                                                class="string">"@string/tab_text"</span>/&gt;</div><div
                                                class="line"></div><div class="line">    <span
                                                class="tag">&lt;<span class="name">android.support.design.widget.TabItem</span></span></div><div
                                                class="line">        <span
                                                class="attr">android:icon</span>=<span
                                                class="string">"@drawable/ic_android"</span>/&gt;</div><div
                                                class="line"></div><div class="line"><span
                                                class="tag">&lt;/<span class="name">android.support.design.widget.TabLayout</span>&gt;</span></div></pre>
                                    </td>
                                </tr>
                            </table>
                        </figure>
                    </p>
                    <p>看过<code>LayoutInflater</code>源码的同学可能会知道这个过程：先inflate到生成View对象，再调用<code>ViewGroup#addView(...)</code>系列方法把view添加到ViewGroup中。我们发现TabLayout的<code>addView(...)</code>系列方法，都删去super调用，且调用了共同的一个方法，<code>addViewInternal(View
                        view)</code>。</p>
                    <figure class="highlight xml">
                        <table>
                            <tr>
                                <td class="gutter">
                                    <pre><div class="line">1</div><div class="line">2</div><div
                                            class="line">3</div><div class="line">4</div><div
                                            class="line">5</div><div class="line">6</div><div
                                            class="line">7</div></pre>
                                </td>
                                <td class="code">
                                    <pre><div class="line">private void addViewInternal(final View child) &#123;</div><div
                                            class="line">    if (child instanceof TabItem) &#123;</div><div
                                            class="line">        addTabFromItemView((TabItem) child);</div><div
                                            class="line">    &#125; else &#123;</div><div
                                            class="line">        throw new IllegalArgumentException("Only TabItem instances can be added to TabLayout");</div><div
                                            class="line">    &#125;</div><div
                                            class="line">&#125;</div></pre>
                                </td>
                            </tr>
                        </table>
                    </figure>
                    <p>可见，若child非<code>TabItem</code>对象会抛出异常。所以xml中给TabLayout添加tab时，只能添加<code>TabItem</code>对象。若想添加其它View类型怎么办？TabItem有<code>android:customView</code>这个属性。我们继续来看。<br>
                        <figure class="highlight java">
                            <table>
                                <tr>
                                    <td class="gutter">
                                        <pre><div class="line">1</div><div class="line">2</div><div
                                                class="line">3</div><div class="line">4</div><div
                                                class="line">5</div><div class="line">6</div><div
                                                class="line">7</div><div class="line">8</div><div
                                                class="line">9</div><div class="line">10</div><div
                                                class="line">11</div><div class="line">12</div><div
                                                class="line">13</div><div class="line">14</div><div
                                                class="line">15</div><div class="line">16</div><div
                                                class="line">17</div><div class="line">18</div><div
                                                class="line">19</div><div class="line">20</div><div
                                                class="line">21</div><div class="line">22</div><div
                                                class="line">23</div><div class="line">24</div><div
                                                class="line">25</div><div class="line">26</div><div
                                                class="line">27</div><div class="line">28</div><div
                                                class="line">29</div><div class="line">30</div><div
                                                class="line">31</div><div class="line">32</div><div
                                                class="line">33</div><div
                                                class="line">34</div></pre>
                                    </td>
                                    <td class="code">
                                        <pre><div class="line"><span class="function"><span
                                                class="keyword">private</span> <span
                                                class="keyword">void</span> <span class="title">addTabFromItemView</span><span
                                                class="params">(@NonNull TabItem item)</span> </span>&#123;</div><div
                                                class="line">    <span class="keyword">final</span> Tab tab = newTab();</div><div
                                                class="line">    <span class="keyword">if</span> (item.mText != <span
                                                class="keyword">null</span>) &#123;</div><div
                                                class="line">        tab.setText(item.mText);</div><div
                                                class="line">    &#125;</div><div
                                                class="line">    <span class="keyword">if</span> (item.mIcon != <span
                                                class="keyword">null</span>) &#123;</div><div
                                                class="line">        tab.setIcon(item.mIcon);</div><div
                                                class="line">    &#125;</div><div
                                                class="line">    <span class="keyword">if</span> (item.mCustomLayout != <span
                                                class="number">0</span>) &#123;</div><div
                                                class="line">        tab.setCustomView(item.mCustomLayout);</div><div
                                                class="line">    &#125;</div><div class="line">    addTab(tab);</div><div
                                                class="line">&#125;</div><div class="line"></div><div
                                                class="line"><span class="function"><span
                                                class="keyword">public</span> Tab <span
                                                class="title">newTab</span><span
                                                class="params">()</span> </span>&#123;</div><div
                                                class="line">    Tab tab = sTabPool.acquire();</div><div
                                                class="line">    <span class="keyword">if</span> (tab == <span
                                                class="keyword">null</span>) &#123;</div><div
                                                class="line">        tab = <span
                                                class="keyword">new</span> Tab();</div><div
                                                class="line">    &#125;</div><div class="line">    tab.mParent = <span
                                                class="keyword">this</span>;</div><div class="line">    tab.mView = createTabView(tab);</div><div
                                                class="line">    <span class="keyword">return</span> tab;</div><div
                                                class="line">&#125;</div><div class="line"></div><div
                                                class="line"><span class="function"><span
                                                class="keyword">private</span> TabView <span
                                                class="title">createTabView</span><span
                                                class="params">(@NonNull <span
                                                class="keyword">final</span> Tab tab)</span> </span>&#123;</div><div
                                                class="line">    TabView tabView = mTabViewPool != <span
                                                class="keyword">null</span> ? mTabViewPool.acquire() : <span
                                                class="keyword">null</span>;</div><div class="line">    <span
                                                class="keyword">if</span> (tabView == <span
                                                class="keyword">null</span>) &#123;</div><div
                                                class="line">        tabView = <span
                                                class="keyword">new</span> TabView(getContext());</div><div
                                                class="line">    &#125;</div><div class="line">    tabView.setTab(tab);</div><div
                                                class="line">    tabView.setFocusable(<span
                                                class="keyword">true</span>);</div><div
                                                class="line">    tabView.setMinimumWidth(getTabMinWidth());</div><div
                                                class="line">    <span class="keyword">return</span> tabView;</div><div
                                                class="line">&#125;</div></pre>
                                    </td>
                                </tr>
                            </table>
                        </figure>
                    </p>
                    <p>
                        这里调<code>newTab()</code>方法创建了一个tab对象，并且用对象池把创建的tab对象缓存起来。然后将<code>TabItem</code>对象的属性都赋值给tab对象。在<code>createTabView(Tab
                        tab)</code>这个方法中，首先从<code>TabView</code>池中获取<code>TabView</code>对象，如果不存在，则实例化一个对象，并调用<code>tabView.setTab(tab)</code>方法来进行了数据绑定。
                        <code>addTab(...)</code>有三个重载方法，最终都会调用如下方法：<br>
                        <figure class="highlight java">
                            <table>
                                <tr>
                                    <td class="gutter">
                                        <pre><div class="line">1</div><div class="line">2</div><div
                                                class="line">3</div><div class="line">4</div><div
                                                class="line">5</div><div class="line">6</div><div
                                                class="line">7</div><div class="line">8</div><div
                                                class="line">9</div><div class="line">10</div><div
                                                class="line">11</div><div class="line">12</div><div
                                                class="line">13</div><div class="line">14</div><div
                                                class="line">15</div><div class="line">16</div><div
                                                class="line">17</div><div class="line">18</div><div
                                                class="line">19</div><div class="line">20</div><div
                                                class="line">21</div><div class="line">22</div><div
                                                class="line">23</div><div class="line">24</div><div
                                                class="line">25</div><div class="line">26</div><div
                                                class="line">27</div><div class="line">28</div><div
                                                class="line">29</div></pre>
                                    </td>
                                    <td class="code">
                                        <pre><div class="line"><span class="function"><span
                                                class="keyword">public</span> <span class="keyword">void</span> <span
                                                class="title">addTab</span><span class="params">(@NonNull Tab tab, <span
                                                class="keyword">boolean</span> setSelected)</span> </span>&#123;</div><div
                                                class="line">    <span class="keyword">if</span> (tab.mParent != <span
                                                class="keyword">this</span>) &#123;</div><div
                                                class="line">        <span
                                                class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span
                                                class="string">"Tab belongs to a different TabLayout."</span>);</div><div
                                                class="line">    &#125;</div><div
                                                class="line"></div><div class="line">    addTabView(tab, setSelected);</div><div
                                                class="line">    configureTab(tab, mTabs.size());</div><div
                                                class="line">    <span class="keyword">if</span> (setSelected) &#123;</div><div
                                                class="line">        tab.select();</div><div
                                                class="line">    &#125;</div><div class="line">&#125;</div><div
                                                class="line"></div><div class="line"><span
                                                class="function"><span
                                                class="keyword">private</span> <span
                                                class="keyword">void</span> <span class="title">addTabView</span><span
                                                class="params">(Tab tab, <span
                                                class="keyword">int</span> position, <span
                                                class="keyword">boolean</span> setSelected)</span> </span>&#123;</div><div
                                                class="line">    <span class="keyword">final</span> TabView tabView = tab.mView;</div><div
                                                class="line">    mTabStrip.addView(tabView, position, createLayoutParamsForTabs());</div><div
                                                class="line">    <span class="keyword">if</span> (setSelected) &#123;</div><div
                                                class="line">        tabView.setSelected(<span
                                                class="keyword">true</span>);</div><div
                                                class="line">    &#125;</div><div class="line">&#125;</div><div
                                                class="line"></div><div class="line"><span
                                                class="function"><span
                                                class="keyword">private</span> <span
                                                class="keyword">void</span> <span class="title">configureTab</span><span
                                                class="params">(Tab tab, <span
                                                class="keyword">int</span> position)</span> </span>&#123;</div><div
                                                class="line">    tab.setPosition(position);</div><div
                                                class="line">    mTabs.add(position, tab);</div><div
                                                class="line"></div><div class="line">    <span
                                                class="keyword">final</span> <span class="keyword">int</span> count = mTabs.size();</div><div
                                                class="line">    <span
                                                class="keyword">for</span> (<span class="keyword">int</span> i = position + <span
                                                class="number">1</span>; i &lt; count; i++) &#123;</div><div
                                                class="line">        mTabs.get(i).setPosition(i);</div><div
                                                class="line">    &#125;</div><div class="line">&#125;</div></pre>
                                    </td>
                                </tr>
                            </table>
                        </figure>
                    </p>
                    <p>在<code>addView(Tab, int,
                        boolean)</code>方法中，把<code>TabView</code>对象add进了<code>SlidingTabStrip</code>这个<code>ViewGroup</code>中。实际上<code>SlidingTabStrip</code>的对象<code>mTabStrip</code>才是<code>TabLayout</code>的唯一子View.在<code>TabLayout</code>的构造方法中:<br>
                        <figure class="highlight java">
                            <table>
                                <tr>
                                    <td class="gutter">
                                        <pre><div class="line">1</div><div class="line">2</div><div
                                                class="line">3</div><div class="line">4</div><div
                                                class="line">5</div><div class="line">6</div><div
                                                class="line">7</div><div class="line">8</div><div
                                                class="line">9</div><div class="line">10</div><div
                                                class="line">11</div></pre>
                                    </td>
                                    <td class="code">
                                        <pre><div class="line"><span class="function"><span
                                                class="keyword">public</span> <span class="title">TabLayout</span><span
                                                class="params">(Context context, AttributeSet attrs, <span
                                                class="keyword">int</span> defStyleAttr)</span> </span>&#123;</div><div
                                                class="line">        <span
                                                class="keyword">super</span>(context, attrs, defStyleAttr);</div><div
                                                class="line">    <span
                                                class="comment">// 禁用横向滑动条</span></div><div
                                                class="line">    setHorizontalScrollBarEnabled(<span
                                                class="keyword">false</span>);</div><div
                                                class="line"></div><div class="line">    <span
                                                class="comment">// new 一个'SlidingTabStrip'的实例，并作为唯一的子View add进'TabLayout'.</span></div><div
                                                class="line">    mTabStrip = <span class="keyword">new</span> SlidingTabStrip(context);</div><div
                                                class="line">    <span class="keyword">super</span>.addView(mTabStrip, <span
                                                class="number">0</span>, <span
                                                class="keyword">new</span> HorizontalScrollView.LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.MATCH_PARENT));</div><div
                                                class="line"></div><div class="line">    <span
                                                class="comment">// 省略下面的无关代码...</span></div><div
                                                class="line">｝</div></pre>
                                    </td>
                                </tr>
                            </table>
                        </figure>
                    </p>
                    <p>至此，我们就明白了<code>TabLayout</code>中子View的一致性是如何保证的。也明白了<code>TabView</code>其实才是亲生的，<code>TabItem</code>其实是后娘养的!
                        这些代码都很简单，不过我们可以从中学习到很多有用的思想。</p>
                    <p>至此，一个清晰的<code>View</code>层级图应该就出现在了各位同学的眼前。<br><img
                            src="../assets/hierarchy.png" alt="TabLayout Hierarchy"></p>
                    <h4 id="3-2-2-与ViewPager搭配使用"><a href="#3-2-2-与ViewPager搭配使用" class="headerlink"
                                                     title="3.2.2 与ViewPager搭配使用"></a>3.2.2
                        与ViewPager搭配使用</h4>
                    <p>
                        有了上面的的基础，我们再来看看<code>TabLayout</code>是如何和它的好基友<code>ViewPager</code>搭配使用的。<br>
                        <figure class="highlight java">
                            <table>
                                <tr>
                                    <td class="gutter">
                                        <pre><div class="line">1</div><div class="line">2</div><div
                                                class="line">3</div><div class="line">4</div><div
                                                class="line">5</div><div class="line">6</div><div
                                                class="line">7</div><div class="line">8</div><div
                                                class="line">9</div><div class="line">10</div><div
                                                class="line">11</div><div class="line">12</div><div
                                                class="line">13</div><div class="line">14</div><div
                                                class="line">15</div><div class="line">16</div><div
                                                class="line">17</div><div class="line">18</div><div
                                                class="line">19</div><div class="line">20</div><div
                                                class="line">21</div><div class="line">22</div><div
                                                class="line">23</div><div class="line">24</div><div
                                                class="line">25</div><div class="line">26</div><div
                                                class="line">27</div><div class="line">28</div><div
                                                class="line">29</div><div class="line">30</div><div
                                                class="line">31</div><div class="line">32</div><div
                                                class="line">33</div><div class="line">34</div><div
                                                class="line">35</div><div class="line">36</div><div
                                                class="line">37</div><div class="line">38</div><div
                                                class="line">39</div><div class="line">40</div><div
                                                class="line">41</div><div class="line">42</div><div
                                                class="line">43</div></pre>
                                    </td>
                                    <td class="code">
                                        <pre><div class="line"><span class="function"><span
                                                class="keyword">public</span> <span class="keyword">void</span> <span
                                                class="title">setupWithViewPager</span><span
                                                class="params">(@Nullable <span class="keyword">final</span> ViewPager viewPager)</span> </span>&#123;</div><div
                                                class="line">    <span class="comment">//...</span></div><div
                                                class="line">    <span class="comment">//为理解简单起见，删掉边角性干扰代码，主要来看核心逻辑</span></div><div
                                                class="line"></div><div class="line">    mViewPager = viewPager;</div><div
                                                class="line"></div><div class="line">    <span
                                                class="comment">// Add our custom OnPageChangeListener to the ViewPager</span></div><div
                                                class="line">    <span class="keyword">if</span> (mPageChangeListener == <span
                                                class="keyword">null</span>) &#123;</div><div
                                                class="line">        mPageChangeListener = <span
                                                class="keyword">new</span> TabLayoutOnPageChangeListener(<span
                                                class="keyword">this</span>);</div><div
                                                class="line">    &#125;</div><div class="line">    mPageChangeListener.reset();</div><div
                                                class="line">    viewPager.addOnPageChangeListener(mPageChangeListener);</div><div
                                                class="line"></div><div class="line">    <span
                                                class="comment">// Now we'll add a tab selected listener to set ViewPager's current item</span></div><div
                                                class="line">    setOnTabSelectedListener(<span
                                                class="keyword">new</span> ViewPagerOnTabSelectedListener(viewPager));</div><div
                                                class="line"></div><div class="line">    <span
                                                class="comment">// Now we'll populate ourselves from the pager adapter</span></div><div
                                                class="line">    setPagerAdapter(adapter, <span
                                                class="keyword">true</span>);</div><div
                                                class="line">&#125;</div><div class="line"></div><div
                                                class="line"><span class="function"><span
                                                class="keyword">public</span> <span class="keyword">void</span> <span
                                                class="title">setOnTabSelectedListener</span><span
                                                class="params">(OnTabSelectedListener onTabSelectedListener)</span> </span>&#123;</div><div
                                                class="line">    mOnTabSelectedListener = onTabSelectedListener;</div><div
                                                class="line">&#125;</div><div class="line"></div><div
                                                class="line"><span class="function"><span
                                                class="keyword">private</span> <span
                                                class="keyword">void</span> <span class="title">setPagerAdapter</span><span
                                                class="params">(@Nullable <span class="keyword">final</span> PagerAdapter adapter, <span
                                                class="keyword">final</span> <span class="keyword">boolean</span> addObserver)</span> </span>&#123;</div><div
                                                class="line">    <span class="keyword">if</span> (mPagerAdapter != <span
                                                class="keyword">null</span> &amp;&amp; mPagerAdapterObserver != <span
                                                class="keyword">null</span>) &#123;</div><div
                                                class="line">        <span class="comment">// If we already have a PagerAdapter, unregister our observer</span></div><div
                                                class="line">        mPagerAdapter.unregisterDataSetObserver(mPagerAdapterObserver);</div><div
                                                class="line">    &#125;</div><div
                                                class="line"></div><div class="line">    mPagerAdapter = adapter;</div><div
                                                class="line"></div><div class="line">    <span
                                                class="keyword">if</span> (addObserver &amp;&amp; adapter != <span
                                                class="keyword">null</span>) &#123;</div><div
                                                class="line">        <span class="comment">// Register our observer on the new adapter</span></div><div
                                                class="line">        <span class="keyword">if</span> (mPagerAdapterObserver == <span
                                                class="keyword">null</span>) &#123;</div><div
                                                class="line">            mPagerAdapterObserver = <span
                                                class="keyword">new</span> PagerAdapterObserver();</div><div
                                                class="line">        &#125;</div><div class="line">        adapter.registerDataSetObserver(mPagerAdapterObserver);</div><div
                                                class="line">    &#125;</div><div
                                                class="line"></div><div class="line">    <span
                                                class="comment">// Finally make sure we reflect the new adapter</span></div><div
                                                class="line">    populateFromPagerAdapter();</div><div
                                                class="line">&#125;</div></pre>
                                    </td>
                                </tr>
                            </table>
                        </figure>
                    </p>
                    <p>这里的<code>TabLayoutOnPageChangeListener</code>实现了<code>ViewPager.OnPageChangeListener</code>.
                        首先调用<code>ViewPager</code>对象<code>addOnPageChangeListener(OnPageChangeListener)</code>来监听<code>ViewPager</code>的滑动以及当前也的选中。然后设置<code>ViewPagerOnTabSelectedListener</code>对象，保证ViewPager的页面和TabLayout的item的选中状态保持一致，以及滚动的协同性。这里的监听在3.2.3中详细讲解。
                    </p>
                    <p>我们一般调用<code>viewPager.getAdapter().notifyDataSetChanged()</code>来进行ViewPager的刷新.
                        现在我们在ViewPager的adapter中注册一个监听器，监听<code>ViewPager</code>的刷新行为。目的是为了刷新<code>ViewPager</code>的同时也可以刷新TabLayout.
                        我们来看看<code>PagerAdapterObserver</code>这个监听器是如何刷新TabLayout的。<br>
                        <figure class="highlight java">
                            <table>
                                <tr>
                                    <td class="gutter">
                                        <pre><div class="line">1</div><div class="line">2</div><div
                                                class="line">3</div><div class="line">4</div><div
                                                class="line">5</div><div class="line">6</div><div
                                                class="line">7</div><div class="line">8</div><div
                                                class="line">9</div><div class="line">10</div><div
                                                class="line">11</div><div class="line">12</div><div
                                                class="line">13</div><div class="line">14</div><div
                                                class="line">15</div><div class="line">16</div><div
                                                class="line">17</div><div class="line">18</div><div
                                                class="line">19</div><div class="line">20</div><div
                                                class="line">21</div><div class="line">22</div><div
                                                class="line">23</div><div class="line">24</div><div
                                                class="line">25</div><div class="line">26</div><div
                                                class="line">27</div><div class="line">28</div><div
                                                class="line">29</div><div class="line">30</div><div
                                                class="line">31</div><div class="line">32</div><div
                                                class="line">33</div><div class="line">34</div><div
                                                class="line">35</div><div class="line">36</div><div
                                                class="line">37</div><div class="line">38</div><div
                                                class="line">39</div><div class="line">40</div><div
                                                class="line">41</div><div class="line">42</div><div
                                                class="line">43</div><div class="line">44</div><div
                                                class="line">45</div><div class="line">46</div><div
                                                class="line">47</div><div
                                                class="line">48</div></pre>
                                    </td>
                                    <td class="code">
                                        <pre><div class="line"><span class="keyword">private</span> <span
                                                class="class"><span
                                                class="keyword">class</span> <span class="title">PagerAdapterObserver</span> <span
                                                class="keyword">extends</span> <span class="title">DataSetObserver</span> </span>&#123;</div><div
                                                class="line">    <span class="meta">@Override</span></div><div
                                                class="line">    <span class="function"><span
                                                class="keyword">public</span> <span class="keyword">void</span> <span
                                                class="title">onChanged</span><span class="params">()</span> </span>&#123;</div><div
                                                class="line">        populateFromPagerAdapter();</div><div
                                                class="line">    &#125;</div><div
                                                class="line"></div><div class="line">    <span
                                                class="meta">@Override</span></div><div
                                                class="line">    <span class="function"><span
                                                class="keyword">public</span> <span class="keyword">void</span> <span
                                                class="title">onInvalidated</span><span
                                                class="params">()</span> </span>&#123;</div><div
                                                class="line">        populateFromPagerAdapter();</div><div
                                                class="line">    &#125;</div><div class="line">&#125;</div><div
                                                class="line"></div><div class="line"><span
                                                class="function"><span
                                                class="keyword">private</span> <span
                                                class="keyword">void</span> <span class="title">populateFromPagerAdapter</span><span
                                                class="params">()</span> </span>&#123;</div><div
                                                class="line">    removeAllTabs();</div><div
                                                class="line"></div><div class="line">    <span
                                                class="keyword">if</span> (mPagerAdapter != <span
                                                class="keyword">null</span>) &#123;</div><div
                                                class="line">        <span
                                                class="keyword">final</span> <span class="keyword">int</span> adapterCount = mPagerAdapter.getCount();</div><div
                                                class="line">        <span
                                                class="keyword">for</span> (<span class="keyword">int</span> i = <span
                                                class="number">0</span>; i &lt; adapterCount; i++) &#123;</div><div
                                                class="line">            addTab(newTab().setText(mPagerAdapter.getPageTitle(i)), <span
                                                class="keyword">false</span>);</div><div
                                                class="line">        &#125;</div><div
                                                class="line"></div><div class="line">        <span
                                                class="comment">// Make sure we reflect the currently set ViewPager item</span></div><div
                                                class="line">        <span class="keyword">if</span> (mViewPager != <span
                                                class="keyword">null</span> &amp;&amp; adapterCount &gt; <span
                                                class="number">0</span>) &#123;</div><div
                                                class="line">            <span
                                                class="keyword">final</span> <span class="keyword">int</span> curItem = mViewPager.getCurrentItem();</div><div
                                                class="line">            <span
                                                class="keyword">if</span> (curItem != getSelectedTabPosition() &amp;&amp; curItem &lt; getTabCount()) &#123;</div><div
                                                class="line">                selectTab(getTabAt(curItem));</div><div
                                                class="line">            &#125;</div><div
                                                class="line">        &#125;</div><div class="line">    &#125; <span
                                                class="keyword">else</span> &#123;</div><div
                                                class="line">        removeAllTabs();</div><div
                                                class="line">    &#125;</div><div class="line">&#125;</div><div
                                                class="line"></div><div class="line"><span
                                                class="function"><span class="keyword">public</span> <span
                                                class="keyword">void</span> <span class="title">removeAllTabs</span><span
                                                class="params">()</span> </span>&#123;</div><div
                                                class="line">    <span class="comment">// Remove all the views</span></div><div
                                                class="line">    <span
                                                class="keyword">for</span> (<span class="keyword">int</span> i = mTabStrip.getChildCount() - <span
                                                class="number">1</span>; i &gt;= <span
                                                class="number">0</span>; i--) &#123;</div><div
                                                class="line">        removeTabViewAt(i);</div><div
                                                class="line">    &#125;</div><div
                                                class="line"></div><div class="line">    <span
                                                class="keyword">for</span> (<span class="keyword">final</span> Iterator&lt;Tab&gt; i = mTabs.iterator(); i.hasNext();) &#123;</div><div
                                                class="line">        <span
                                                class="keyword">final</span> Tab tab = i.next();</div><div
                                                class="line">        i.remove();</div><div
                                                class="line">        tab.reset();</div><div
                                                class="line">        sTabPool.release(tab);</div><div
                                                class="line">    &#125;</div><div
                                                class="line"></div><div class="line">    mSelectedTab = <span
                                                class="keyword">null</span>;</div><div class="line">&#125;</div></pre>
                                    </td>
                                </tr>
                            </table>
                        </figure>
                    </p>
                    <p>刷新方式很简单粗暴，从<code>SlidingTabStrip</code>对象中移除所有的<code>TabView</code>，继而从View
                        Model<code>mTabs</code>中移除所有<code>Tab</code>对象。然后从adapter中获取tab信息，循环调用<code>addTab(Tab,
                            boolean)</code>方法重新添加<code>TabView</code>。最后调用<code>ViewPager</code>对象的<code>getCurrentItem()</code>方法，获取当前位置，然后调用selectTab(int
                        position)恢复<code>TabView</code>的选中状态（针对TabView的选中，3.2.4中有详细介绍)。</p>
                    <h4 id="3-2-3-ViewPager与TabLayout的Tab及indicaotr协同滚动"><a
                            href="#3-2-3-ViewPager与TabLayout的Tab及indicaotr协同滚动" class="headerlink"
                            title="3.2.3 ViewPager与TabLayout的Tab及indicaotr协同滚动"></a>3.2.3
                        ViewPager与TabLayout的Tab及indicaotr协同滚动</h4>
                    <figure class="highlight java">
                        <table>
                            <tr>
                                <td class="gutter">
                                    <pre><div class="line">1</div><div class="line">2</div><div
                                            class="line">3</div><div class="line">4</div><div
                                            class="line">5</div><div class="line">6</div><div
                                            class="line">7</div><div class="line">8</div><div
                                            class="line">9</div><div class="line">10</div><div
                                            class="line">11</div><div class="line">12</div><div
                                            class="line">13</div><div class="line">14</div><div
                                            class="line">15</div><div class="line">16</div><div
                                            class="line">17</div><div class="line">18</div><div
                                            class="line">19</div><div class="line">20</div><div
                                            class="line">21</div><div class="line">22</div><div
                                            class="line">23</div><div class="line">24</div><div
                                            class="line">25</div><div class="line">26</div><div
                                            class="line">27</div><div class="line">28</div><div
                                            class="line">29</div><div class="line">30</div><div
                                            class="line">31</div><div class="line">32</div><div
                                            class="line">33</div><div class="line">34</div><div
                                            class="line">35</div><div class="line">36</div><div
                                            class="line">37</div><div class="line">38</div><div
                                            class="line">39</div><div class="line">40</div><div
                                            class="line">41</div><div class="line">42</div><div
                                            class="line">43</div><div class="line">44</div><div
                                            class="line">45</div><div class="line">46</div><div
                                            class="line">47</div><div class="line">48</div><div
                                            class="line">49</div></pre>
                                </td>
                                <td class="code">
                                    <pre><div class="line"><span class="keyword">public</span> <span
                                            class="keyword">static</span> <span class="class"><span
                                            class="keyword">class</span> <span class="title">TabLayoutOnPageChangeListener</span> <span
                                            class="keyword">implements</span> <span class="title">ViewPager</span>.<span
                                            class="title">OnPageChangeListener</span> </span>&#123;</div><div
                                            class="line">    <span
                                            class="keyword">private</span> <span class="keyword">final</span> WeakReference&lt;TabLayout&gt; mTabLayoutRef;</div><div
                                            class="line">    <span
                                            class="keyword">private</span> <span
                                            class="keyword">int</span> mPreviousScrollState;</div><div
                                            class="line">    <span
                                            class="keyword">private</span> <span
                                            class="keyword">int</span> mScrollState;</div><div
                                            class="line"></div><div class="line">    <span
                                            class="function"><span
                                            class="keyword">public</span> <span class="title">TabLayoutOnPageChangeListener</span><span
                                            class="params">(TabLayout tabLayout)</span> </span>&#123;</div><div
                                            class="line">        mTabLayoutRef = <span
                                            class="keyword">new</span> WeakReference&lt;&gt;(tabLayout);</div><div
                                            class="line">    &#125;</div><div class="line"></div><div
                                            class="line">    <span
                                            class="meta">@Override</span></div><div class="line">    <span
                                            class="function"><span
                                            class="keyword">public</span> <span
                                            class="keyword">void</span> <span class="title">onPageScrollStateChanged</span><span
                                            class="params">(<span class="keyword">int</span> state)</span> </span>&#123;</div><div
                                            class="line">        mPreviousScrollState = mScrollState;</div><div
                                            class="line">        mScrollState = state;</div><div
                                            class="line">    &#125;</div><div class="line"></div><div
                                            class="line">    <span
                                            class="meta">@Override</span></div><div class="line">    <span
                                            class="function"><span
                                            class="keyword">public</span> <span
                                            class="keyword">void</span> <span class="title">onPageScrolled</span><span
                                            class="params">(<span class="keyword">int</span> position, <span
                                            class="keyword">float</span> positionOffset, <span
                                            class="keyword">int</span> positionOffsetPixels)</span> </span>&#123;</div><div
                                            class="line">        <span class="keyword">final</span> TabLayout tabLayout = mTabLayoutRef.get();</div><div
                                            class="line">        <span class="keyword">if</span> (tabLayout != <span
                                            class="keyword">null</span>) &#123;</div><div
                                            class="line">            <span class="comment">// Only update the text selection if we're not settling, or we are settling after</span></div><div
                                            class="line">            <span class="comment">// being dragged</span></div><div
                                            class="line">            <span
                                            class="keyword">final</span> <span class="keyword">boolean</span> updateText = mScrollState != SCROLL_STATE_SETTLING ||</div><div
                                            class="line">                    mPreviousScrollState == SCROLL_STATE_DRAGGING;</div><div
                                            class="line">            <span class="comment">// Update the indicator if we're not settling after being idle. This is caused</span></div><div
                                            class="line">            <span class="comment">// from a setCurrentItem() call and will be handled by an animation from</span></div><div
                                            class="line">            <span class="comment">// onPageSelected() instead.</span></div><div
                                            class="line">            <span
                                            class="keyword">final</span> <span class="keyword">boolean</span> updateIndicator = !(mScrollState == SCROLL_STATE_SETTLING</div><div
                                            class="line">                    &amp;&amp; mPreviousScrollState == SCROLL_STATE_IDLE);</div><div
                                            class="line">            tabLayout.setScrollPosition(position, positionOffset, updateText, updateIndicator);</div><div
                                            class="line">        &#125;</div><div class="line">    &#125;</div><div
                                            class="line"></div><div class="line">    <span
                                            class="meta">@Override</span></div><div class="line">    <span
                                            class="function"><span
                                            class="keyword">public</span> <span
                                            class="keyword">void</span> <span class="title">onPageSelected</span><span
                                            class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</div><div
                                            class="line">        <span class="keyword">final</span> TabLayout tabLayout = mTabLayoutRef.get();</div><div
                                            class="line">        <span class="keyword">if</span> (tabLayout != <span
                                            class="keyword">null</span> &amp;&amp; tabLayout.getSelectedTabPosition() != position) &#123;</div><div
                                            class="line">            <span class="comment">// Select the tab, only updating the indicator if we're not being dragged/settled</span></div><div
                                            class="line">            <span class="comment">// (since onPageScrolled will handle that).</span></div><div
                                            class="line">            <span
                                            class="keyword">final</span> <span class="keyword">boolean</span> updateIndicator = mScrollState == SCROLL_STATE_IDLE</div><div
                                            class="line">                    || (mScrollState == SCROLL_STATE_SETTLING</div><div
                                            class="line">                    &amp;&amp; mPreviousScrollState == SCROLL_STATE_IDLE);</div><div
                                            class="line">            tabLayout.selectTab(tabLayout.getTabAt(position), updateIndicator);</div><div
                                            class="line">        &#125;</div><div class="line">    &#125;</div><div
                                            class="line"></div><div class="line">    <span
                                            class="function"><span
                                            class="keyword">private</span> <span class="keyword">void</span> <span
                                            class="title">reset</span><span class="params">()</span> </span>&#123;</div><div
                                            class="line">        mPreviousScrollState = mScrollState = SCROLL_STATE_IDLE;</div><div
                                            class="line">    &#125;</div><div
                                            class="line">&#125;</div></pre>
                                </td>
                            </tr>
                        </table>
                    </figure>
                    <p>用过<code>ViewPager</code>的同学对<code>OnPageChangeListener</code>不会陌生，不多赘述。<code>TabLayoutOnPageChangeListener</code>实现了<code>OnPageChangeListener</code>,
                        在<code>onPageScrolled(...)</code>方法中做协同滚动处理。滚动的条件是：<br>
                        <figure class="highlight java">
                            <table>
                                <tr>
                                    <td class="gutter">
                                        <pre><div class="line">1</div></pre>
                                    </td>
                                    <td class="code">
                                        <pre><div class="line"><span
                                                class="keyword">final</span> <span class="keyword">boolean</span> updateIndicator = !(mScrollState == SCROLL_STATE_SETTLING &amp;&amp; mPreviousScrollState == SCROLL_STATE_IDLE);</div></pre>
                                    </td>
                                </tr>
                            </table>
                        </figure>
                    </p>
                    <p>
                        调用<code>TabLayout的setScrollPosition(...)</code>方法来控制<code>TabLayout</code>中<code>TabView</code>和indocator的协同滚动。<br>
                        <figure class="highlight java">
                            <table>
                                <tr>
                                    <td class="gutter">
                                        <pre><div class="line">1</div><div class="line">2</div><div
                                                class="line">3</div><div class="line">4</div><div
                                                class="line">5</div><div class="line">6</div><div
                                                class="line">7</div><div class="line">8</div><div
                                                class="line">9</div><div class="line">10</div><div
                                                class="line">11</div><div class="line">12</div><div
                                                class="line">13</div><div class="line">14</div><div
                                                class="line">15</div><div class="line">16</div><div
                                                class="line">17</div><div class="line">18</div><div
                                                class="line">19</div><div class="line">20</div><div
                                                class="line">21</div><div
                                                class="line">22</div></pre>
                                    </td>
                                    <td class="code">
                                        <pre><div class="line"><span class="function"><span
                                                class="keyword">private</span> <span
                                                class="keyword">void</span> <span class="title">setScrollPosition</span><span
                                                class="params">(<span class="keyword">int</span> position, <span
                                                class="keyword">float</span> positionOffset, <span
                                                class="keyword">boolean</span> updateSelectedText, <span
                                                class="keyword">boolean</span> updateIndicatorPosition)</span> </span>&#123;</div><div
                                                class="line">    <span class="keyword">final</span> <span
                                                class="keyword">int</span> roundedPosition = Math.round(position + positionOffset);</div><div
                                                class="line">    <span class="keyword">if</span> (roundedPosition &lt; <span
                                                class="number">0</span> || roundedPosition &gt;= mTabStrip.getChildCount()) &#123;</div><div
                                                class="line">        <span
                                                class="keyword">return</span>;</div><div
                                                class="line">    &#125;</div><div
                                                class="line"></div><div class="line">    <span
                                                class="comment">// Set the indicator position, if enabled</span></div><div
                                                class="line">    <span class="keyword">if</span> (updateIndicatorPosition) &#123;</div><div
                                                class="line">        mTabStrip.setIndicatorPositionFromTabPosition(position, positionOffset);</div><div
                                                class="line">    &#125;</div><div
                                                class="line"></div><div class="line">    <span
                                                class="comment">// Now update the scroll position, canceling any running animation</span></div><div
                                                class="line">    <span class="keyword">if</span> (mScrollAnimator != <span
                                                class="keyword">null</span> &amp;&amp; mScrollAnimator.isRunning()) &#123;</div><div
                                                class="line">        mScrollAnimator.cancel();</div><div
                                                class="line">    &#125;</div><div class="line">    scrollTo(calculateScrollXForTab(position, positionOffset), <span
                                                class="number">0</span>);</div><div
                                                class="line"></div><div class="line">    <span
                                                class="comment">// Update the 'selected state' view as we scroll, if enabled</span></div><div
                                                class="line">    <span class="keyword">if</span> (updateSelectedText) &#123;</div><div
                                                class="line">        setSelectedTabView(roundedPosition);</div><div
                                                class="line">    &#125;</div><div class="line">&#125;</div></pre>
                                    </td>
                                </tr>
                            </table>
                        </figure>
                    </p>
                    <h5 id="3-2-3-1-TabLayout的Indicator协同滚动"><a
                            href="#3-2-3-1-TabLayout的Indicator协同滚动" class="headerlink"
                            title="3.2.3.1 TabLayout的Indicator协同滚动"></a>3.2.3.1
                        TabLayout的Indicator协同滚动</h5>
                    <p>indicator的滚动由SlidingTabStrip来处理：</p>
                    <figure class="highlight java">
                        <table>
                            <tr>
                                <td class="gutter">
                                    <pre><div class="line">1</div><div class="line">2</div><div
                                            class="line">3</div><div class="line">4</div></pre>
                                </td>
                                <td class="code">
                                    <pre><div class="line"><span class="comment">// Set the indicator position, if enabled</span></div><div
                                            class="line"><span class="keyword">if</span> (updateIndicatorPosition) &#123;</div><div
                                            class="line">    mTabStrip.setIndicatorPositionFromTabPosition(position, positionOffset);</div><div
                                            class="line">&#125;</div></pre>
                                </td>
                            </tr>
                        </table>
                    </figure>
                    <p>这里的<code>position</code>是当前选中的位置。<code>positionOffset</code>是: <code>距当前Tab滑动的距离</code>／<code>从当前tab滑动到下一个tab的总距离</code>
                        这样一个范围在［0，1］间的小数。</p>
                    <p>SlidingTabStrip#setIndicatorPositionFromTabPosition(int, float)<br>
                        <figure class="highlight java">
                            <table>
                                <tr>
                                    <td class="gutter">
                                        <pre><div class="line">1</div><div class="line">2</div><div
                                                class="line">3</div><div class="line">4</div><div
                                                class="line">5</div><div class="line">6</div><div
                                                class="line">7</div><div class="line">8</div><div
                                                class="line">9</div></pre>
                                    </td>
                                    <td class="code">
                                        <pre><div class="line"><span class="function"><span
                                                class="keyword">void</span> <span class="title">setIndicatorPositionFromTabPosition</span><span
                                                class="params">(<span class="keyword">int</span> position, <span
                                                class="keyword">float</span> positionOffset)</span> </span>&#123;</div><div
                                                class="line">    <span class="keyword">if</span> (mIndicatorAnimator != <span
                                                class="keyword">null</span> &amp;&amp; mIndicatorAnimator.isRunning()) &#123;</div><div
                                                class="line">        mIndicatorAnimator.cancel();</div><div
                                                class="line">    &#125;</div><div
                                                class="line"></div><div class="line">    mSelectedPosition = position;</div><div
                                                class="line">    mSelectionOffset = positionOffset;</div><div
                                                class="line">    updateIndicatorPosition();</div><div
                                                class="line">&#125;</div></pre>
                                    </td>
                                </tr>
                            </table>
                        </figure>
                    </p>
                    <p>SlidingTabStrip#updateIndicatorPosition()<br>
                        <figure class="highlight java">
                            <table>
                                <tr>
                                    <td class="gutter">
                                        <pre><div class="line">1</div><div class="line">2</div><div
                                                class="line">3</div><div class="line">4</div><div
                                                class="line">5</div><div class="line">6</div><div
                                                class="line">7</div><div class="line">8</div><div
                                                class="line">9</div><div class="line">10</div><div
                                                class="line">11</div><div class="line">12</div><div
                                                class="line">13</div><div class="line">14</div><div
                                                class="line">15</div><div class="line">16</div><div
                                                class="line">17</div><div class="line">18</div><div
                                                class="line">19</div><div class="line">20</div><div
                                                class="line">21</div><div
                                                class="line">22</div></pre>
                                    </td>
                                    <td class="code">
                                        <pre><div class="line"><span class="function"><span
                                                class="keyword">private</span> <span
                                                class="keyword">void</span> <span class="title">updateIndicatorPosition</span><span
                                                class="params">()</span> </span>&#123;</div><div
                                                class="line">    <span class="keyword">final</span> View selectedTitle = getChildAt(mSelectedPosition);</div><div
                                                class="line">    <span class="keyword">int</span> left, right;</div><div
                                                class="line"></div><div class="line">    <span
                                                class="keyword">if</span> (selectedTitle != <span
                                                class="keyword">null</span> &amp;&amp; selectedTitle.getWidth() &gt; <span
                                                class="number">0</span>) &#123;</div><div
                                                class="line">        left = selectedTitle.getLeft();</div><div
                                                class="line">        right = selectedTitle.getRight();</div><div
                                                class="line"></div><div class="line">        <span
                                                class="keyword">if</span> (mSelectionOffset &gt; <span
                                                class="number">0f</span> &amp;&amp; mSelectedPosition &lt; getChildCount() - <span
                                                class="number">1</span>) &#123;</div><div
                                                class="line">            <span class="comment">// Draw the selection partway between the tabs</span></div><div
                                                class="line">            View nextTitle = getChildAt(mSelectedPosition + <span
                                                class="number">1</span>);</div><div class="line">            left = (<span
                                                class="keyword">int</span>) (mSelectionOffset * nextTitle.getLeft() +</div><div
                                                class="line">                    (<span
                                                class="number">1.0f</span> - mSelectionOffset) * left);</div><div
                                                class="line">            right = (<span
                                                class="keyword">int</span>) (mSelectionOffset * nextTitle.getRight() +</div><div
                                                class="line">                    (<span
                                                class="number">1.0f</span> - mSelectionOffset) * right);</div><div
                                                class="line">        &#125;</div><div class="line">    &#125; <span
                                                class="keyword">else</span> &#123;</div><div
                                                class="line">        left = right = -<span
                                                class="number">1</span>;</div><div class="line">    &#125;</div><div
                                                class="line"></div><div class="line">    setIndicatorPosition(left, right);</div><div
                                                class="line">&#125;</div></pre>
                                    </td>
                                </tr>
                            </table>
                        </figure>
                    </p>
                    <p>通过<code>getChildAt(mSelectedPosition)</code>,
                        获取到到<code>mSelectedPosition</code>处的TabView。若滑动的<code>mSelectionOffset&gt;0f</code>且当前选中的位置<code>mSelectedPosition</code>不是最后一个TabView.
                        获取到下一个TabView，并计算出indicator的left和right。</p>
                    <p>SlidingTabStrip＃setIndicatorPosition(int, int)<br>
                        <figure class="highlight java">
                            <table>
                                <tr>
                                    <td class="gutter">
                                        <pre><div class="line">1</div><div class="line">2</div><div
                                                class="line">3</div><div class="line">4</div><div
                                                class="line">5</div><div class="line">6</div><div
                                                class="line">7</div><div class="line">8</div></pre>
                                    </td>
                                    <td class="code">
                                        <pre><div class="line"><span class="function"><span
                                                class="keyword">private</span> <span
                                                class="keyword">void</span> <span class="title">setIndicatorPosition</span><span
                                                class="params">(<span class="keyword">int</span> left, <span
                                                class="keyword">int</span> right)</span> </span>&#123;</div><div
                                                class="line">    <span class="keyword">if</span> (left != mIndicatorLeft || right != mIndicatorRight) &#123;</div><div
                                                class="line">        <span class="comment">// If the indicator's left/right has changed, invalidate</span></div><div
                                                class="line">        mIndicatorLeft = left;</div><div
                                                class="line">        mIndicatorRight = right;</div><div
                                                class="line">        ViewCompat.postInvalidateOnAnimation(<span
                                                class="keyword">this</span>);</div><div
                                                class="line">    &#125;</div><div class="line">&#125;</div></pre>
                                    </td>
                                </tr>
                            </table>
                        </figure>
                    </p>
                    <p>非常简单的代码，在调用<code>ViewCompat.postInvalidateOnAnimation(this)</code>重绘View之前，去掉一些重复绘制的帧。
                    </p>
                    <figure class="highlight java">
                        <table>
                            <tr>
                                <td class="gutter">
                                    <pre><div class="line">1</div><div class="line">2</div><div
                                            class="line">3</div><div class="line">4</div><div
                                            class="line">5</div><div class="line">6</div><div
                                            class="line">7</div><div class="line">8</div><div
                                            class="line">9</div><div class="line">10</div></pre>
                                </td>
                                <td class="code">
                                    <pre><div class="line"><span class="meta">@Override</span></div><div
                                            class="line"><span class="function"><span
                                            class="keyword">public</span> <span
                                            class="keyword">void</span> <span
                                            class="title">draw</span><span class="params">(Canvas canvas)</span> </span>&#123;</div><div
                                            class="line">    <span class="keyword">super</span>.draw(canvas);</div><div
                                            class="line"></div><div class="line">    <span
                                            class="comment">// Thick colored underline below the current selection</span></div><div
                                            class="line">    <span class="keyword">if</span> (mIndicatorLeft &gt;= <span
                                            class="number">0</span> &amp;&amp; mIndicatorRight &gt; mIndicatorLeft) &#123;</div><div
                                            class="line">        canvas.drawRect(mIndicatorLeft, getHeight() - mSelectedIndicatorHeight,</div><div
                                            class="line">                mIndicatorRight, getHeight(), mSelectedIndicatorPaint);</div><div
                                            class="line">    &#125;</div><div
                                            class="line">&#125;</div></pre>
                                </td>
                            </tr>
                        </table>
                    </figure>
                    <p>绘制逻辑很简单。调用<code>canvas.drawRect(float left, float top, float right, float
                        bottom, Paint paint)</code>来绘制indicator.这里：<br>
                        <figure class="highlight java">
                            <table>
                                <tr>
                                    <td class="gutter">
                                        <pre><div class="line">1</div><div class="line">2</div><div
                                                class="line">3</div><div class="line">4</div></pre>
                                    </td>
                                    <td class="code">
                                        <pre><div class="line">left = mIndicatorLeft;</div><div
                                                class="line">top = getHeight() - mSelectedIndicatorHeight;</div><div
                                                class="line">right = mIndicatorRight;</div><div
                                                class="line">bottom = getHeight();</div></pre>
                                    </td>
                                </tr>
                            </table>
                        </figure>
                    </p>
                    <h5 id="3-2-3-2-TabLayout的TabView协同滚动"><a href="#3-2-3-2-TabLayout的TabView协同滚动"
                                                              class="headerlink"
                                                              title="3.2.3.2 TabLayout的TabView协同滚动"></a>3.2.3.2
                        TabLayout的TabView协同滚动</h5>
                    <p>我们回头来看 3.2.3中<code>setScrollPosition(...)</code>方法<br>
                        <figure class="highlight java">
                            <table>
                                <tr>
                                    <td class="gutter">
                                        <pre><div class="line">1</div><div class="line">2</div><div
                                                class="line">3</div><div class="line">4</div><div
                                                class="line">5</div><div class="line">6</div><div
                                                class="line">7</div><div class="line">8</div><div
                                                class="line">9</div><div class="line">10</div><div
                                                class="line">11</div><div class="line">12</div><div
                                                class="line">13</div><div class="line">14</div><div
                                                class="line">15</div><div class="line">16</div><div
                                                class="line">17</div><div class="line">18</div><div
                                                class="line">19</div><div class="line">20</div><div
                                                class="line">21</div><div
                                                class="line">22</div></pre>
                                    </td>
                                    <td class="code">
                                        <pre><div class="line"><span class="function"><span
                                                class="keyword">private</span> <span
                                                class="keyword">void</span> <span class="title">setScrollPosition</span><span
                                                class="params">(<span class="keyword">int</span> position, <span
                                                class="keyword">float</span> positionOffset, <span
                                                class="keyword">boolean</span> updateSelectedText, <span
                                                class="keyword">boolean</span> updateIndicatorPosition)</span> </span>&#123;</div><div
                                                class="line">    <span class="keyword">final</span> <span
                                                class="keyword">int</span> roundedPosition = Math.round(position + positionOffset);</div><div
                                                class="line">    <span class="keyword">if</span> (roundedPosition &lt; <span
                                                class="number">0</span> || roundedPosition &gt;= mTabStrip.getChildCount()) &#123;</div><div
                                                class="line">        <span
                                                class="keyword">return</span>;</div><div
                                                class="line">    &#125;</div><div
                                                class="line"></div><div class="line">    <span
                                                class="comment">// Set the indicator position, if enabled</span></div><div
                                                class="line">    <span class="keyword">if</span> (updateIndicatorPosition) &#123;</div><div
                                                class="line">        mTabStrip.setIndicatorPositionFromTabPosition(position, positionOffset);</div><div
                                                class="line">    &#125;</div><div
                                                class="line"></div><div class="line">    <span
                                                class="comment">// Now update the scroll position, canceling any running animation</span></div><div
                                                class="line">    <span class="keyword">if</span> (mScrollAnimator != <span
                                                class="keyword">null</span> &amp;&amp; mScrollAnimator.isRunning()) &#123;</div><div
                                                class="line">        mScrollAnimator.cancel();</div><div
                                                class="line">    &#125;</div><div class="line">    scrollTo(calculateScrollXForTab(position, positionOffset), <span
                                                class="number">0</span>);</div><div
                                                class="line"></div><div class="line">    <span
                                                class="comment">// Update the 'selected state' view as we scroll, if enabled</span></div><div
                                                class="line">    <span class="keyword">if</span> (updateSelectedText) &#123;</div><div
                                                class="line">        setSelectedTabView(roundedPosition);</div><div
                                                class="line">    &#125;</div><div class="line">&#125;</div></pre>
                                    </td>
                                </tr>
                            </table>
                        </figure>
                    </p>
                    <p>在3.2.3.1中我们知道indicator的滚动是通过<code>mTabStrip.setIndicatorPositionFromTabPosition(position,
                        positionOffset)</code>实现的。那TabView的滚动呢？我们知道<code>TabLayout</code>是继承<code>HorizonScrollView</code>天生就是一个可以横行滚动的<code>View</code>，所以，我们只需要调用<code>scrollTo(int
                        x, int y)</code>方法就可以实现横向滚动。<br>
                        <figure class="highlight java">
                            <table>
                                <tr>
                                    <td class="gutter">
                                        <pre><div class="line">1</div></pre>
                                    </td>
                                    <td class="code">
                                        <pre><div class="line">scrollTo(calculateScrollXForTab(position, positionOffset), <span
                                                class="number">0</span>);</div></pre>
                                    </td>
                                </tr>
                            </table>
                        </figure>
                    </p>
                    <p>这里x方向的偏移量调用<code>calculateScrollXForTab(position, positionOffset)</code>实时计算得出，y方向的偏移量为0。<br>
                        <figure class="highlight java">
                            <table>
                                <tr>
                                    <td class="gutter">
                                        <pre><div class="line">1</div><div class="line">2</div><div
                                                class="line">3</div><div class="line">4</div><div
                                                class="line">5</div><div class="line">6</div><div
                                                class="line">7</div><div class="line">8</div><div
                                                class="line">9</div><div class="line">10</div><div
                                                class="line">11</div><div class="line">12</div><div
                                                class="line">13</div><div class="line">14</div><div
                                                class="line">15</div><div
                                                class="line">16</div></pre>
                                    </td>
                                    <td class="code">
                                        <pre><div class="line"><span class="function"><span
                                                class="keyword">private</span> <span
                                                class="keyword">int</span> <span class="title">calculateScrollXForTab</span><span
                                                class="params">(<span class="keyword">int</span> position, <span
                                                class="keyword">float</span> positionOffset)</span> </span>&#123;</div><div
                                                class="line">    <span class="keyword">if</span> (mMode == MODE_SCROLLABLE) &#123;</div><div
                                                class="line">        <span
                                                class="keyword">final</span> View selectedChild = mTabStrip.getChildAt(position);</div><div
                                                class="line">        <span
                                                class="keyword">final</span> View nextChild = position + <span
                                                class="number">1</span> &lt; mTabStrip.getChildCount()</div><div
                                                class="line">                ? mTabStrip.getChildAt(position + <span
                                                class="number">1</span>)</div><div class="line">                : <span
                                                class="keyword">null</span>;</div><div class="line">        <span
                                                class="keyword">final</span> <span class="keyword">int</span> selectedWidth = selectedChild != <span
                                                class="keyword">null</span> ? selectedChild.getWidth() : <span
                                                class="number">0</span>;</div><div class="line">        <span
                                                class="keyword">final</span> <span class="keyword">int</span> nextWidth = nextChild != <span
                                                class="keyword">null</span> ? nextChild.getWidth() : <span
                                                class="number">0</span>;</div><div
                                                class="line"></div><div class="line">        <span
                                                class="keyword">return</span> selectedChild.getLeft()</div><div
                                                class="line">                + ((<span
                                                class="keyword">int</span>) ((selectedWidth + nextWidth) * positionOffset * <span
                                                class="number">0.5f</span>))</div><div class="line">                + (selectedChild.getWidth() / <span
                                                class="number">2</span>)</div><div class="line">                - (getWidth() / <span
                                                class="number">2</span>);</div><div class="line">    &#125;</div><div
                                                class="line">    <span class="keyword">return</span> <span
                                                class="number">0</span>;</div><div class="line">&#125;</div></pre>
                                    </td>
                                </tr>
                            </table>
                        </figure>
                    </p>
                    <p>至此，我们就明白了<code>TabLayout</code>是如何随<code>ViewPager</code>的滚动而滚动的。</p>
                    <h3 id="3-2-4-Tab选中状态"><a href="#3-2-4-Tab选中状态" class="headerlink"
                                              title="3.2.4 Tab选中状态"></a>3.2.4 Tab选中状态</h3>
                    <figure class="highlight java">
                        <table>
                            <tr>
                                <td class="gutter">
                                    <pre><div class="line">1</div><div class="line">2</div><div
                                            class="line">3</div><div class="line">4</div><div
                                            class="line">5</div><div class="line">6</div><div
                                            class="line">7</div><div class="line">8</div><div
                                            class="line">9</div></pre>
                                </td>
                                <td class="code">
                                    <pre><div class="line"><span class="function"><span
                                            class="keyword">private</span> <span class="keyword">void</span> <span
                                            class="title">setSelectedTabView</span><span
                                            class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</div><div
                                            class="line">    <span
                                            class="keyword">final</span> <span
                                            class="keyword">int</span> tabCount = mTabStrip.getChildCount();</div><div
                                            class="line">    <span class="keyword">if</span> (position &lt; tabCount &amp;&amp; !mTabStrip.getChildAt(position).isSelected()) &#123;</div><div
                                            class="line">        <span
                                            class="keyword">for</span> (<span
                                            class="keyword">int</span> i = <span
                                            class="number">0</span>; i &lt; tabCount; i++) &#123;</div><div
                                            class="line">            <span
                                            class="keyword">final</span> View child = mTabStrip.getChildAt(i);</div><div
                                            class="line">            child.setSelected(i == position);</div><div
                                            class="line">        &#125;</div><div class="line">    &#125;</div><div
                                            class="line">&#125;</div></pre>
                                </td>
                            </tr>
                        </table>
                    </figure>
                    <p>调用View的<code>setSelected(boolean)</code>方法。</p>
                    <h2 id="4-开源项目中的使用"><a href="#4-开源项目中的使用" class="headerlink"
                                           title="4. 开源项目中的使用"></a>4. 开源项目中的使用</h2>
                    <p>开源项目中使用TabLayout的例子特别多, 这里给出我写的一个项目：</p>
                    <ul>
                        <li><a href="https://github.com/Aspsine/SwipeToLoadLayout" target="_blank"
                               rel="external">SwipeToLoadLayout</a>的demo
                        </li>
                    </ul>
                    <hr>
                    <p style="color:#159957">
                        发现文章，代码有误、对内容有疑问，请在<a href="https://github.com/qydq/issues/issues"
                                              class="post-more waves-effect waves-button">Issue</a>上面提单，技术讨论可以给我Email，欢迎关注左边<a
                            href="http://open.weixin.qq.com/qr/code/?username=liketip">微信公众号</a>或加<a
                            href="https://github.com/qydq/qydq.github.io/blob/master/res/e_group.png?raw=true">QQ群</a>获取更多信息。
                        <br>
                    <p><img src="/res/likeqy_group.png" alt=""></p>

                </div>

                <blockquote class="post-copyright">
                    <div class="content">

<span class="post-time">
    Last updated: <time datetime="2017-07-26T12:06:32.545Z" itemprop="dateUpdated">2017-07-26 20:06:32</time>
</span><br>


                    </div>
                    <footer>
                        <a href="/">
                            <img src="/res/index-page-topleft-bg.jpg" alt="晴雨【qy】">
                            晴雨【qy】
                        </a>
                    </footer>
                </blockquote>


                <div class="page-reward">
                    <a id="rewardBtn" href="javascript:;"
                       class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
                </div>


                <div class="post-footer">

                    <ul class="article-tag-list">
                        <li class="article-tag-list-item">
                            <a class="article-tag-list-link" href="/tags/Android/">Android</a>
                        </li>
                        <li class="article-tag-list-item">
                            <a class="article-tag-list-link" href="/tags/转载/">转载</a>
                        </li>
                    </ul>


                    <div class="page-share-wrap">


                        <div class="page-share" id="pageShare">
                            <ul class="reset share-icons">
                                <li>
                                    <a class="weibo share-sns" target="_blank"
                                       href="http://service.weibo.com/share/share.php?url=https://likeqy.com/2017/07/26/TabLayout源码解析/&title=《TabLayout源码解析》 — likeqy.com&pic=https://likeqy.com/res/kotlin_250x250.jpg"
                                       data-title="微博">
                                        <i class="icon icon-weibo"></i>
                                    </a>
                                </li>
                                <li>
                                    <a class="weixin share-sns wxFab" href="javascript:;"
                                       data-title="微信">
                                        <i class="icon icon-weixin"></i>
                                    </a>
                                </li>
                                <li>
                                    <a class="qq share-sns" target="_blank"
                                       href="http://connect.qq.com/widget/shareqq/index.html?url=https://likeqy.com/2017/07/26/TabLayout源码解析/&title=《TabLayout源码解析》 — likeqy.com&source=talk is cheap,show me the girl."
                                       data-title=" QQ">
                                        <i class="icon icon-qq"></i>
                                    </a>
                                </li>
                                <li>
                                    <a class="facebook share-sns" target="_blank"
                                       href="https://www.facebook.com/sharer/sharer.php?u=https://likeqy.com/2017/07/26/TabLayout源码解析/"
                                       data-title=" Facebook">
                                        <i class="icon icon-facebook"></i>
                                    </a>
                                </li>
                                <li>
                                    <a class="twitter share-sns" target="_blank"
                                       href="https://twitter.com/intent/tweet?text=《TabLayout源码解析》 — likeqy.com&url=https://likeqy.com/2017/07/26/TabLayout源码解析/&via=https://likeqy.com"
                                       data-title=" Twitter">
                                        <i class="icon icon-twitter"></i>
                                    </a>
                                </li>
                                <li>
                                    <a class="google share-sns" target="_blank"
                                       href="https://plus.google.com/share?url=https://likeqy.com/2017/07/26/TabLayout源码解析/"
                                       data-title=" Google+">
                                        <i class="icon icon-google-plus"></i>
                                    </a>
                                </li>
                            </ul>
                        </div>


                        <a href="javascript:;" id="shareFab"
                           class="page-share-fab waves-effect waves-circle">
                            <i class="icon icon-share-alt icon-lg"></i>
                        </a>
                    </div>


                </div>
            </div>


        </article>

        <div id="reward" class="page-modal reward-lay">
            <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
            <h3 class="reward-title">
                <i class="icon icon-quote-left"></i>
                奖励一杯咖啡!
                <i class="icon icon-quote-right"></i>
            </h3>
            <div class="reward-content">

                <div class="reward-code">
                    <img id="rewardCode" src="/res/alipay.png" alt="打赏二维码">
                </div>

                <label class="reward-toggle">
                    <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                           data-wechat="/res/wechart_pay.png"
                           data-alipay="/res/alipay.png">
                    <div class="reward-toggle-ctrol">
                        <span class="reward-toggle-item wechat">微信</span>
                        <span class="reward-toggle-label"></span>
                        <span class="reward-toggle-item alipay">支付宝</span>
                    </div>
                </label>

            </div>
        </div>


    </div>

    <footer class="footer">

        <div class="bottom">

            <p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
            </p>


            <p>
                <span>sunshuntao &copy; 2017</span> &nbsp&nbsp&nbsp 作者Github地址 欢迎关注 <a
                    href="https://github.com/qydq" target="_blank">晴雨【qy】</a>
                <a href="/atom.xml" target="_blank" class="rss" title="rss"><i
                        class="icon icon-lg icon-rss"></i></a>
            </p>
            <p>
                感谢阿里云提供<a href="https://www.aliyun.com/"
                          target="_blank">虚拟主机</a>
            </p>
            <p>
                <span>Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a
                        href="https://github.com/yscoder/hexo-theme-indigo"
                        target="_blank">indigo</a></span>
            </p>
        </div>
    </footer>

</main>
<div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span
        class="icon icon-lg icon-chevron-up"></span></a>


<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
        <li>
            <a class="weibo share-sns" target="_blank"
               href="http://service.weibo.com/share/share.php?url=https://likeqy.com/2017/07/26/TabLayout源码解析/&title=《TabLayout源码解析》 — likeqy.com&pic=https://likeqy.com/res/kotlin_250x250.jpg"
               data-title="微博">
                <i class="icon icon-weibo"></i>
            </a>
        </li>
        <li>
            <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
                <i class="icon icon-weixin"></i>
            </a>
        </li>
        <li>
            <a class="qq share-sns" target="_blank"
               href="http://connect.qq.com/widget/shareqq/index.html?url=https://likeqy.com/2017/07/26/TabLayout源码解析/&title=《TabLayout源码解析》 — likeqy.com&source=talk is cheap,show me the girl."
               data-title=" QQ">
                <i class="icon icon-qq"></i>
            </a>
        </li>
        <li>
            <a class="facebook share-sns" target="_blank"
               href="https://www.facebook.com/sharer/sharer.php?u=https://likeqy.com/2017/07/26/TabLayout源码解析/"
               data-title=" Facebook">
                <i class="icon icon-facebook"></i>
            </a>
        </li>
        <li>
            <a class="twitter share-sns" target="_blank"
               href="https://twitter.com/intent/tweet?text=《TabLayout源码解析》 — likeqy.com&url=https://likeqy.com/2017/07/26/TabLayout源码解析/&via=https://likeqy.com"
               data-title=" Twitter">
                <i class="icon icon-twitter"></i>
            </a>
        </li>
        <li>
            <a class="google share-sns" target="_blank"
               href="https://plus.google.com/share?url=https://likeqy.com/2017/07/26/TabLayout源码解析/"
               data-title=" Google+">
                <i class="icon icon-google-plus"></i>
            </a>
        </li>
    </ul>
</div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACLklEQVR42u3awa7CIBAF0Pf/P+3buhC9F6pJ4bAytbUcTCYzMH9/8Xg8jdH1529H9z9/O/o8euqCgYGBcVvG4+1IGFfd8/69o3swMDDOYbRhMQ/H175reB0DAwMjmProShJY81/AwMDAaBnJ77yvOjEwMDByRlLErmzP5cXt12txDAyMGzLa4PjLz18538DAwLgV41GOJDi2h5R5eB3OCgMDY2tGHuDylDE/pCwK1KT5AwMDY1NGGyLzSeQFZ9uu8eIKBgbG1oyVVC8Pi8lTc6nni/8EAwNja8bc9n1yf1ugtouFgYGxNyNP+9qgnLRK5Cnjh2XCwMDYmtFu1n9jMy45NogOODEwMDZlzIW8ep3KlLFu9cDAwDiM8ZvGi7kkcvg7GBgYxzDmNr/agnbuaLPoFsHAwDiM0TZk/LLZ4oLzTwwMjFsx5l6WhMi5AJ0H9+H5BgYGxkaMdmt+JflrC+a8vwIDA2NvxkrStlLWrm/kYWBgnMNYCZR5gE5aLvJjiQ8tFxgYGFsz2mK1LTXn7kyWDAMD4xxGEv6SrbSckTTIJsuKgYFxDqN+LD4MmEtA20XHwMDYlfEox9wW/3op+4GKgYGxNSMfeQKX925ddbSAgYFxAqMNsnOtGG15XK83BgbGAYx2qytphlhp2mhni4GBgbHSIpZPdCmHxcDAwIhTvZVjgLl2MQwMjHMYyYvz6c4F63brDQMD4xxGm3flbV75tNrwPXmoiYGBcT/GP2yc8C4/GITlAAAAAElFTkSuQmCC"
         alt="微信分享二维码">
</div>


<script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };



lazyScripts.push('//s95.cnzz.com/z_stat.php?id=1261686164&web_id=1261686164')



</script>

<script src="/js/main.min.js?v=1.5.2"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
    <li class="item">
        <a href="{path}" class="waves-block waves-effect">
            <div class="title ellipsis" title="{title}">{title}</div>
            <div class="flex-row flex-middle">
                <div class="tags ellipsis">
                    {tags}
                </div>
                <time class="flex-col time">{date}</time>
            </div>
        </a>
    </li>
</template>

<script src="/js/search.min.js?v=1.5.2" async></script>


<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>


</body>
</html>
